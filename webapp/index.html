<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>NEXUS PRO</title><script src="https://telegram.org/js/telegram-web-app.js"></script><script src="https://cdn.tailwindcss.com"></script><script src="https://unpkg.com/vue@3/dist/vue.global.js"></script><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');:root { --bg: #020617; --card: rgba(30, 41, 59, 0.6); --accent: #38bdf8; }body { background: var(--bg); color: white; font-family: 'Outfit', sans-serif; overflow-x: hidden; }.glass { background: var(--card); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }.snowflake { position: fixed; top: -10px; z-index: 99; color: white; pointer-events: none; animation: fall linear infinite; }@keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }.lights { position: fixed; top: 0; width: 100%; display: flex; justify-content: space-around; z-index: 100; }.light { width: 10px; height: 10px; border-radius: 50%; animation: glow 1.2s infinite alternate; }@keyframes glow { from { opacity: 0.3; } to { opacity: 1; box-shadow: 0 0 15px currentColor; } }.tab-active { color: var(--accent); filter: drop-shadow(0 0 8px var(--accent)); }.slide-up { animation: slideUp 0.4s ease-out; }@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }.fade-in { animation: fadeIn 0.5s ease; }@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; }}</style></head>
<body class="min-h-screen pb-24">
    <div class="lights"><div v-for="c in ['#ef4444','#22c55e','#3b82f6','#eab308']" class="light" :style="{backgroundColor: c, color: c, animationDuration: (Math.random()*0.5+1)+'s'}"></div></div><div id="snow"></div>
    {% raw %}<div id="app">
        <div v-if="loading" class="fixed inset-0 z-[100] flex flex-col justify-center items-center bg-[#020617]"><div class="w-16 h-16 border-4 border-sky-500 border-t-transparent rounded-full animate-spin"></div><h1 class="mt-6 text-xl tracking-widest animate-pulse">NEXUS WALLET</h1></div>
        <div v-else class="p-4 pt-8">
            <div v-if="tab === 'wallet'" class="fade-in"><div class="flex justify-between items-center mb-8"><div><p class="text-gray-400 text-sm">Welcome,</p><h2 class="text-2xl font-black">{{ user.username }}</h2></div><div class="w-12 h-12 rounded-2xl glass flex items-center justify-center border-sky-500/30"><i class="fas fa-snowflake text-sky-400"></i></div></div><div class="glass rounded-[2rem] p-8 mb-8 border-sky-500/20 shadow-2xl shadow-sky-500/10"><p class="text-sky-300/60 text-xs font-bold mb-1 uppercase tracking-widest">Total Balance</p><h1 class="text-5xl font-black">{{ user.total_balance }}</h1></div><div class="grid grid-cols-4 gap-4 mb-10 text-center"><div @click="openModal('send')" class="cursor-pointer group"><div class="w-14 h-14 rounded-2xl glass mx-auto flex items-center justify-center text-sky-400 group-active:scale-90 transition-all"><i class="fas fa-paper-plane"></i></div><span class="text-[10px] font-bold mt-2 block">SEND</span></div><div @click="openModal('receive')" class="cursor-pointer group"><div class="w-14 h-14 rounded-2xl glass mx-auto flex items-center justify-center text-emerald-400 group-active:scale-90 transition-all"><i class="fas fa-qrcode"></i></div><span class="text-[10px] font-bold mt-2 block">RECEIVE</span></div><div @click="tab='swap'" class="cursor-pointer group"><div class="w-14 h-14 rounded-2xl glass mx-auto flex items-center justify-center text-purple-400 group-active:scale-90 transition-all"><i class="fas fa-repeat"></i></div><span class="text-[10px] font-bold mt-2 block">SWAP</span></div><div @click="tab='p2p'" class="cursor-pointer group"><div class="w-14 h-14 rounded-2xl glass mx-auto flex items-center justify-center text-amber-400 group-active:scale-90 transition-all"><i class="fas fa-handshake"></i></div><span class="text-[10px] font-bold mt-2 block">P2P</span></div></div><div class="space-y-4"><div v-for="w in user.wallets" class="glass p-5 rounded-2xl flex justify-between items-center border-l-4 border-l-sky-500"><div class="flex items-center gap-4"><div class="text-3xl">{{ w.icon }}</div><div><h4 class="font-bold">{{ w.symbol }}</h4><p class="text-[10px] text-gray-500">{{ w.network }}</p></div></div><div class="text-right"><p class="font-bold">{{ w.balance }}</p><p class="text-xs text-green-400">≈ ${{ w.usd_value }}</p></div></div></div></div>
            <div v-if="tab === 'p2p'" class="fade-in"><h2 class="text-2xl font-black mb-6">P2P MARKET</h2><div class="flex bg-white/5 rounded-2xl p-1 mb-6"><button @click="p2pType='buy'; fetchP2P()" :class="['w-1/2 py-3 rounded-xl font-bold', p2pType==='buy'?'bg-emerald-500 shadow-lg':'text-gray-500']">BUY</button><button @click="p2pType='sell'; fetchP2P()" :class="['w-1/2 py-3 rounded-xl font-bold', p2pType==='sell'?'bg-rose-500 shadow-lg':'text-gray-500']">SELL</button></div><div class="space-y-4"><div v-for="o in p2pOrders" class="glass p-5 rounded-3xl border-white/5"><div class="flex justify-between mb-4"><span class="font-black text-xl text-emerald-400">{{ o.price }} {{ o.fiat }}</span><span class="text-xs font-bold bg-white/10 px-3 py-1 rounded-full uppercase">{{ o.token }}</span></div><p class="text-xs text-gray-400 mb-4">Limits: {{ o.min }} - {{ o.max }} {{ o.fiat }}</p><button class="w-full py-4 rounded-2xl font-black bg-white/5 border border-white/10 active:scale-95">START TRADE</button></div></div></div>
            <div v-if="tab === 'history'" class="fade-in"><h2 class="text-2xl font-black mb-6 uppercase">Activity</h2><div v-if="!history.length" class="text-center text-gray-500 mt-20"><i class="fas fa-receipt text-5xl mb-4"></i><p>No transactions yet.</p></div><div v-else class="space-y-3"><div v-for="t in history" class="glass p-4 rounded-2xl flex justify-between items-center"><div class="flex items-center gap-4"><div :class="['w-10 h-10 rounded-full flex items-center justify-center', t.type==='send'?'bg-rose-500/20 text-rose-400':'bg-emerald-500/20 text-emerald-400']"><i :class="t.type==='send'?'fas fa-arrow-up':'fas fa-arrow-down'"></i></div><div><h4 class="font-bold text-sm uppercase">{{ t.type }}</h4><p class="text-[10px] text-gray-500">{{ t.date }}</p></div></div><div class="text-right"><p class="font-bold">{{ t.amount }}</p><p class="text-[10px] text-gray-500 font-bold">{{ t.symbol }}</p></div></div></div></div>
            <div v-if="tab === 'settings'" class="fade-in"><h2 class="text-2xl font-black mb-6">SETTINGS</h2><div class="glass rounded-3xl overflow-hidden border-white/5 mb-6"><div class="p-6 border-b border-white/5 flex justify-between items-center cursor-pointer" @click="updateSetting('default_currency', user.currency === 'USD' ? 'EUR' : 'USD')"><div class="flex items-center gap-4"><i class="fas fa-coins text-sky-400"></i><span class="font-bold">Currency</span></div><span class="text-sky-500 font-black">{{ user.currency }} <i class="fas fa-chevron-right ml-2 text-[10px]"></i></span></div><div class="p-6 flex justify-between items-center cursor-pointer" @click="updateSetting('language_code', user.lang === 'en' ? 'ru' : 'en')"><div class="flex items-center gap-4"><i class="fas fa-globe text-purple-400"></i><span class="font-bold">Language</span></div><span class="text-purple-500 font-black">{{ user.lang.toUpperCase() }} <i class="fas fa-chevron-right ml-2 text-[10px]"></i></span></div></div><button @click="tgClose()" class="w-full py-5 rounded-2xl glass text-rose-400 font-black uppercase">Exit Wallet</button></div>
        </div>
        <div class="fixed bottom-4 left-4 right-4 h-20 glass rounded-[2.5rem] flex justify-around items-center px-4 z-[90] border-white/10 shadow-2xl"><div @click="tab='wallet'" :class="['p-4 transition-all', tab==='wallet'?'tab-active scale-125':'text-gray-500']"><i class="fas fa-wallet"></i></div><div @click="tab='p2p'" :class="['p-4 transition-all', tab==='p2p'?'tab-active scale-125':'text-gray-500']"><i class="fas fa-handshake"></i></div><div @click="tab='swap'" :class="['p-4 transition-all', tab==='swap'?'tab-active scale-125':'text-gray-500']"><i class="fas fa-repeat"></i></div><div @click="tab='history'" :class="['p-4 transition-all', tab==='history'?'tab-active scale-125':'text-gray-500']"><i class="fas fa-history"></i></div><div @click="tab='settings'" :class="['p-4 transition-all', tab==='settings'?'tab-active scale-125':'text-gray-500']"><i class="fas fa-cog"></i></div></div>
        <div v-if="modalOpen" class="fixed inset-0 z-[100] flex items-end justify-center bg-black/80 backdrop-blur-md" @click.self="closeModal"><div class="bg-[#0f172a] w-full rounded-t-[3rem] p-8 border-t border-white/10 slide-up"><div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-8"></div><div v-if="modalType==='send'"><h3 class="text-2xl font-black mb-6">SEND CRYPTO</h3><select v-model="form.network" class="w-full glass p-5 rounded-2xl mb-4 outline-none"><option v-for="w in user.wallets" :value="w.network">{{w.network}}</option></select><input v-model="form.address" placeholder="Recipient Address" class="w-full glass p-5 rounded-2xl mb-4 outline-none"><input v-model="form.amount" type="number" placeholder="0.00" class="w-full glass p-5 rounded-2xl mb-6 font-black text-2xl"><button @click="openPinModal('send')" class="w-full bg-sky-500 py-5 rounded-2xl font-black shadow-lg">CONTINUE</button></div><div v-if="modalType==='receive'" class="text-center"><h3 class="text-2xl font-black mb-6">YOUR QR CODE</h3><div class="bg-white p-4 rounded-[2rem] inline-block mb-6"><img :src="`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${user.wallets[0].address}`"></div><div class="glass p-5 rounded-2xl mb-6 font-mono text-[10px] break-all">{{ user.wallets[0].address }}</div><button @click="copy(user.wallets[0].address)" class="w-full py-5 rounded-2xl bg-white/5 border border-white/10 font-bold">COPY ADDRESS</button></div><div v-if="modalType==='pin'"><h3 class="text-2xl font-black mb-2 text-center uppercase">Confirm PIN</h3><p class="text-center text-gray-500 text-xs mb-8">Security check required</p><input v-model="pin" type="password" maxlength="6" class="w-full bg-transparent text-center text-5xl font-black tracking-[0.5em] outline-none my-10" placeholder="••••••"><button @click="executeRealAction" class="w-full bg-emerald-500 py-5 rounded-2xl font-black shadow-lg">CONFIRM & SEND</button></div></div></div>
    </div>{% endraw %}
    <script>
        const { createApp } = Vue; const tg = window.Telegram.WebApp;
        createApp({
            data: () => ({ loading: true, tab: 'wallet', p2pType: 'sell', modalOpen: false, modalType: '', user: {}, history: [], p2pOrders: [], pin: '', form: { network: 'ethereum', address: '', amount: '', token: 'ETH' }, pendingAction: '' }),
            watch: { tab(t) { if (t === 'history') this.fetchHistory(); if (t === 'p2p') this.fetchP2P(); } },
            async mounted() {
                tg.expand();
                await this.refreshData(tg.initDataUnsafe?.user?.id || 8405499025);
                this.createSnow(); this.loading = false;
            },
            methods: {
                async refreshData(uid) { const [u, h, p] = await Promise.all([axios.get(`/api/user/${uid}`), axios.get(`/api/history/${uid}`), axios.get(`/api/p2p/orders?type=${this.p2pType}`)]); this.user = u.data; this.history = h.data; this.p2pOrders = p.data; },
                async executeRealAction() {
                    this.loading = true; this.modalOpen = false;
                    try {
                        if (this.pendingAction === 'send') { const res = await axios.post('/api/send', { ...this.form, user_id: this.user.id, pin: this.pin }); this.tgAlert("Success! Hash: " + res.data.tx_hash.substring(0,10)); }
                        await this.refreshData(this.user.id);
                    } catch(e) { this.tgAlert("Error: " + e.response.data.detail); }
                    finally { this.loading = false; this.pin = ''; }
                },
                openModal(t) { this.modalType = t; this.modalOpen = true; },
                openPinModal(a) { this.pendingAction = a; this.modalType = 'pin'; this.pin = ''; },
                closeModal() { this.modalOpen = false; },
                async updateSetting(field, value) { this.loading = true; await axios.post('/api/settings/update', { user_id: this.user.id, field, value }); await this.refreshData(this.user.id); this.loading = false; this.tgAlert("Settings Updated!"); },
                async fetchP2P() { this.p2pOrders = (await axios.get(`/api/p2p/orders?type=${this.p2pType}`)).data; },
                async fetchHistory() { this.history = (await axios.get(`/api/history/${this.user.id}`)).data; },
                createSnow() { const c = document.getElementById('snow'); for (let i=0; i<40; i++) { const s = document.createElement('div'); s.className = 'snowflake'; s.innerHTML = '❄'; s.style.left=Math.random()*100+'vw'; s.style.animationDuration=Math.random()*3+2+'s'; s.style.fontSize=Math.random()*10+10+'px'; c.appendChild(s); } },
                tgAlert(m) { tg.showAlert(m); }, copy(v) { navigator.clipboard.writeText(v); this.tgAlert("Copied!"); }, tgClose() { tg.close(); }
            }
        }).mount('#app');
    </script>
</body>
</html>
