{% extends "tg/base.html" %}

{% block title %}Receive - NEXUS{% endblock %}

{% block content %}
<div class="header">
    <div class="header-content">
        <div class="logo">
            <span class="logo-icon">ğŸ“¥</span>
            <span>Receive</span>
        </div>
    </div>
</div>

<main class="main">
    {% if step == 'no_wallets' %}
    <!-- No Wallets -->
    <div class="empty-state">
        <div class="empty-icon">ğŸ“¥</div>
        <div class="empty-title">No Wallets</div>
        <div class="empty-text">Create a wallet first to receive crypto</div>
        <a href="/tg/create" class="btn btn-primary">Create Wallet</a>
    </div>
    
    {% elif step == 'select_network' %}
    <!-- Select Network -->
    <a href="/tg/" class="back-link">â† Back</a>
    
    <h2 class="page-title">Select Wallet</h2>
    <p class="page-subtitle">Choose which wallet to receive to</p>
    
    <div class="network-list">
        {% for wallet in wallets %}
        <a href="/tg/receive/{{ wallet.id }}" class="network-item" onclick="haptic('light')">
            <div class="network-icon">{{ wallet.icon }}</div>
            <div class="network-info">
                <div class="network-name">{{ wallet.name }}</div>
                <div class="network-address">{{ wallet.address[:8] }}...{{ wallet.address[-6:] }}</div>
            </div>
            <div class="network-arrow">â€º</div>
        </a>
        {% endfor %}
    </div>
    
    {% elif step == 'show_address' %}
    <!-- Show Address & QR -->
    <a href="/tg/receive" class="back-link">â† Back</a>
    
    <div class="receive-container">
        <div class="receive-header">
            <span class="receive-icon">{{ network.icon }}</span>
            <span class="receive-network">{{ network.name }}</span>
        </div>
        
        <div class="qr-container">
            <canvas id="qrcode"></canvas>
        </div>
        
        <div class="address-container">
            <div class="address-label">Your {{ network.symbol }} Address</div>
            <div class="address-box" onclick="copyToClipboard('{{ wallet.address }}')">
                <code class="address-text">{{ wallet.address }}</code>
                <span class="copy-icon">ğŸ“‹</span>
            </div>
            <div class="copy-hint">Tap to copy address</div>
        </div>
        
        <div class="receive-actions">
            <button class="btn btn-primary" onclick="copyToClipboard('{{ wallet.address }}')">
                ğŸ“‹ Copy Address
            </button>
            <button class="btn btn-secondary" onclick="shareAddress()">
                ğŸ“¤ Share
            </button>
        </div>
        
        <div class="alert alert-warning">
            âš ï¸ Only send <strong>{{ network.symbol }}</strong> and tokens on <strong>{{ network.name }}</strong> network to this address!
        </div>
    </div>
    {% endif %}
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/tg/" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span>Home</span>
        </a>
        <a href="/tg/wallet" class="nav-item">
            <span class="nav-icon">ğŸ’¼</span>
            <span>Wallet</span>
        </a>
        <a href="/tg/history" class="nav-item">
            <span class="nav-icon">ğŸ“œ</span>
            <span>History</span>
        </a>
        <a href="/tg/settings" class="nav-item">
            <span class="nav-icon">âš™ï¸</span>
            <span>Settings</span>
        </a>
    </nav>
</main>
{% endblock %}

{% block scripts %}
{% if step == 'show_address' %}
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const address = '{{ wallet.address }}';
    QRCode.toCanvas(document.getElementById('qrcode'), address, {
        width: 220,
        margin: 2,
        color: {
            dark: '#000000',
            light: '#ffffff'
        }
    });
});

function shareAddress() {
    const address = '{{ wallet.address }}';
    const text = 'My {{ network.name }} address: ' + address;
    
    if (navigator.share) {
        navigator.share({
            title: 'NEXUS Wallet Address',
            text: text
        });
    } else {
        copyToClipboard(address);
    }
    haptic('medium');
}
</script>
{% endif %}
{% endblock %}