{% extends "tg/base.html" %}

{% block title %}Send {{ network.symbol if network else '' }} - NEXUS{% endblock %}

{% block content %}
<div class="header">
    <div class="header-content">
        <div class="logo">
            <span class="logo-icon">üì§</span>
            <span>Send {% if network %}{{ network.symbol }}{% endif %}</span>
        </div>
    </div>
</div>

<main class="main">
    {% if success %}
    <!-- Success State -->
    <div class="success-state">
        <div class="success-icon">‚úÖ</div>
        <div class="success-title">Transaction Sent!</div>
        <div class="success-text">Your transaction is being processed</div>
    </div>
    
    <div class="card">
        <div class="card-title" style="margin-bottom: 12px;">Transaction Hash</div>
        <div class="wallet-address" onclick="copyToClipboard('{{ tx_hash }}'); haptic('medium');">
            <code>{{ tx_hash[:20] }}...{{ tx_hash[-10:] }}</code>
            <button class="btn-icon">üìã</button>
        </div>
        
        {% if network %}
        <a href="{{ network.explorer_url }}/tx/{{ tx_hash }}" target="_blank" class="btn btn-secondary" style="margin-top: 12px;">
            üîç View on Explorer
        </a>
        {% endif %}
    </div>
    
    <a href="/tg/?tgWebAppData={{ request.query_params.get('tgWebAppData', '') }}" class="btn btn-primary" style="margin-top: 16px;">
        ‚Üê Back to Wallets
    </a>
    
    {% else %}
    <!-- Send Form -->
    <a href="/tg/wallet/{{ wallet.id }}?tgWebAppData={{ request.query_params.get('tgWebAppData', '') }}" class="back-link">
        ‚Üê Back
    </a>
    
    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}
    
    <!-- Balance -->
    <div class="balance-display">
        <div class="balance-label">Available Balance</div>
        <div class="balance-value">
            {{ balance|default('0') }}
            <span class="symbol">{% if network %}{{ network.symbol }}{% endif %}</span>
        </div>
    </div>
    
    <form method="POST" action="/tg/send/{{ wallet.id }}?tgWebAppData={{ request.query_params.get('tgWebAppData', '') }}">
        <div class="form-group">
            <label class="form-label">Recipient Address</label>
            <input 
                type="text" 
                name="to_address" 
                class="form-input" 
                placeholder="Enter wallet address"
                required
            >
        </div>
        
        <div class="form-group">
            <label class="form-label">Amount {% if network %}({{ network.symbol }}){% endif %}</label>
            <div class="amount-input-group">
                <input 
                    type="number" 
                    name="amount" 
                    id="amount"
                    class="form-input" 
                    placeholder="0.0"
                    step="any"
                    min="0"
                    required
                >
                <button type="button" class="btn btn-secondary" onclick="setMaxAmount(); haptic('light');">
                    MAX
                </button>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary" onclick="haptic('medium');">
            üì§ Send {% if network %}{{ network.symbol }}{% endif %}
        </button>
    </form>
    {% endif %}
</main>
{% endblock %}

{% block scripts %}
<script>
const balance = parseFloat("{{ balance|default('0') }}") || 0;

function setMaxAmount() {
    document.getElementById('amount').value = balance;
}
</script>
{% endblock %}